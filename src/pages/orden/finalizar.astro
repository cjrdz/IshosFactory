---
import OrderLayout from "../../layouts/OrderLayout.astro";
import OrderForm from "../../components/svelte/OrderForm.svelte";
import OrderSummaryCard from "../../components/svelte/OrderSummaryCard.svelte";
import EmptyCart from "../../components/astro/EmptyCart.astro";
import Toast from "../../components/svelte/Toast.svelte";
import type { OrderFormData } from "../../types/order";
import configData from "../../content/config.json";

function handleSubmit(data: OrderFormData) {
    // Redirect to confirmation page with order data
    const params = new URLSearchParams();
    params.set("name", data.name);
    params.set("phone", data.phone);
    params.set("orderType", data.orderType);
    if (data.address) params.set("address", data.address);
    if (data.notes) params.set("notes", data.notes);

    window.location.href = `/orden/confirmacion?${params.toString()}`;
}
---

<OrderLayout title={`Finalizar Pedido - ${configData.store.name}`}>
    <div class="mb-8">
        <h1 class="text-4xl font-bold mb-4">Finalizar Pedido</h1>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2">
            <div class="bg-base-100 rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold mb-4">Informaci√≥n del Pedido</h2>
                <OrderForm
                    onSubmit={handleSubmit}
                    currencySymbol={configData.settings.currencySymbol}
                    client:load
                />
            </div>
        </div>
        <div class="lg:col-span-1">
            <OrderSummaryCard
                currencySymbol={configData.settings.currencySymbol}
                taxRate={configData.settings.taxRate}
                showTax={false}
                client:load
            />
        </div>
    </div>

    <Toast client:load />
</OrderLayout>
