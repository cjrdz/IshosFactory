---
import { getCollection } from 'astro:content';
import MenuLayout from "../../../layouts/MenuLayout.astro";
import CategoryTabs from "../../../components/astro/CategoryTabs.astro";
import ProductDetail from "../../../components/svelte/ProductDetail.svelte";
import Toast from "../../../components/svelte/Toast.svelte";
import configData from "../../../content/config.json";
import { entryToProduct } from "../../../lib/utils/content-helpers";

// Generate static paths for all products
export async function getStaticPaths() {
    const entries = await getCollection('menu');
    
    return entries.map((entry) => ({
        params: { id: entry.data.id },
    }));
}

const entries = await getCollection('menu');
const { id } = Astro.params;

const entry = entries.find((e) => e.data.id === id);

if (!entry) {
    return Astro.redirect("/menu");
}

const product = entryToProduct(entry);

if (!product.available) {
    return Astro.redirect("/menu");
}

// Determine category for tabs
const category = product.category;
---

<MenuLayout title={`${product.name} - ${configData.store.name}`}>
    <div class="mb-8">
        <a href="/menu" class="btn btn-ghost btn-sm mb-4"> ← Volver al Menú </a>
        <CategoryTabs currentCategory={category} />
    </div>

    <ProductDetail
        product={product}
        currencySymbol={configData.settings.currencySymbol}
        client:load
    />

    <Toast client:load />
</MenuLayout>
